# ~/.tmux.conf

# TMUX CONFIGURATION
# ==============================================================================
# PREFIX AND CONTROL
# ------------------------------------------------------------------------------
# Use Control-` as prefix
unbind C-b
set-option -g prefix C-`
bind-key C-` send-prefix

# Faster key handling
set -sg escape-time 0
set -g status-interval 0
set -g repeat-time 300

# ------------------------------------------------------------------------------
# MOUSE SETTINGS
# ------------------------------------------------------------------------------
# Enable mouse (pane/window selection, resize). Hold Option in terminal to bypass if needed.
set -g mouse on

# Smooth copy-mode + scroll behavior
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# ------------------------------------------------------------------------------
# KEY BINDINGS
# ------------------------------------------------------------------------------

# Reload config file
bind r source-file ~/.tmux.conf \; display-message "config reloaded!"

# Clear screen and scrollback (prefix + C-l)
unbind -n C-k
bind C-l send-keys -R \; send-keys C-l \; clear-history

# Window and session management
bind W new-window
bind S new-session

# Pane navigation (vim-style)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Window next/prev
bind -r m select-window -t :+
bind -r n select-window -t :-

# Layout management
unbind =
bind = select-layout tiled

# Split panes (preserve current path)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Resize pane shortcuts
bind -r H resize-pane -L 10
bind -r K resize-pane -U 10
bind -r L resize-pane -R 10
bind -r J resize-pane -D 10

# Fullscreen maximize/restore workflow
unbind Up
bind Up new-window -d -n fullscreen \; swap-pane -s fullscreen.1 \; select-window -t fullscreen
unbind Down
bind Down last-window \; swap-pane -s fullscreen.1 \; kill-window -t fullscreen

# ------------------------------------------------------------------------------
# NUMBER NAVIGATION (windows and panes)
# ------------------------------------------------------------------------------

# Windows: prefix + 0..9 (explicit, for clarity)
bind -r 0 select-window -t :0
bind -r 1 select-window -t :1
bind -r 2 select-window -t :2
bind -r 3 select-window -t :3
bind -r 4 select-window -t :4
bind -r 5 select-window -t :5
bind -r 6 select-window -t :6
bind -r 7 select-window -t :7
bind -r 8 select-window -t :8
bind -r 9 select-window -t :9

# ------------------------------------------------------------------------------
# CLIPBOARD (macOS-safe)
# ------------------------------------------------------------------------------

# If reattach-to-user-namespace is installed, keep these. Otherwise, prefer pbcopy/pbpaste directly.
# Copy active buffer to macOS clipboard
if-shell 'command -v reattach-to-user-namespace >/dev/null 2>&1' \
  'bind C-c run "tmux save-buffer - | reattach-to-user-namespace pbcopy"; bind C-v run "tmux set-buffer $(reattach-to-user-namespace pbpaste); tmux paste-buffer"' \
  'bind C-c run "tmux save-buffer - | pbcopy"; bind C-v run "tmux set-buffer $(pbpaste); tmux paste-buffer"'

# ------------------------------------------------------------------------------
# STATUS BAR CONFIG
# ------------------------------------------------------------------------------
set-option -g status-interval 1
set-option -g status-left ''
set-option -g status-right ''

set -g status-bg black
set -g status-fg green
set -g status-left "[#S] "
# set -g status-right "#[fg=green]CPU: #{cpu_percentage} #[fg=yellow]MEM: #{ram_percentage} #[fg=green]%Y-%m-%d #[fg=yellow]%H:%M"

# Window list styling
set -g window-status-format '#[fg=yellow]#I:#W#F'
set -g window-status-current-format '#[fg=green,bold]#I:#W#F'
set -g window-status-separator ' | '

# ------------------------------------------------------------------------------
# PLUGIN SETTINGS (TPM, Resurrect, Continuum, Menus)
# ------------------------------------------------------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'jaclu/tmux-menus'

# Core tmux settings for Continuum/Resurrect
set -g status on
set -g history-limit 5000

# Resurrect settings
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-dir '~/.tmux/resurrect'
set -g @resurrect-strategy-nvim 'session'  # restore nvim sessions if using Session.vim

# Continuum settings - auto save and restore
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

set -g @menus_trigger 'Space'

# Initialize TPM (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
